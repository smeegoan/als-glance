"use strict";var aucBubbleChart,muscleChart,quarterChart,timeHourChart,timeOfDayChart,predictionSeriesChart,dateRangeChart,emgChart,alsglance=alsglance||{};alsglance.dashboard=alsglance.dashboard||{resizeChart:function(n){var t=$("#"+n.anchorName()).parent(),i=t.width(),r=t.height(),u=t.children().size();n.width(i);u==1&&n.height(r)},resize:function(){for(var t,n=0;n<dc.chartRegistry.list().length;n++)t=dc.chartRegistry.list()[n],t.transitionDuration(0),alsglance.dashboard.resizeChart(t);for(dc.renderAll(),n=0;n<dc.chartRegistry.list().length;n++)t=dc.chartRegistry.list()[n],t.transitionDuration(500)},replaceResetBehaviour:function(){for(var n,t=0;t<dc.chartRegistry.list().length;t++)n=dc.chartRegistry.list()[t],n.turnOnControls=alsglance.dashboard.turnOnControls(n),n.turnOffControls=alsglance.dashboard.turnOffControls(n)},turnOnControls:function(n){return function(){var i=n.root()[0][0],t,r;return i!=null&&(t=i.parentNode.parentNode,r=n.filterPrinter(),d3.select(t).selectAll(".reset").style("display",null),d3.select(t).selectAll(".filter").text(r(n.filters())).style("display",null)),n}},init:function(){alsglance.dashboard.replaceResetBehaviour();$(window).resize(function(){this.resizeTO&&clearTimeout(this.resizeTO);this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},500)});$(window).bind("resizeEnd",function(){alsglance.dashboard.resize()});alsglance.dashboard.resize()},turnOffControls:function(n){return function(){var i=n.root()[0][0],t;return i!=null&&(t=i.parentNode.parentNode,d3.select(t).selectAll(".reset").style("display","none"),d3.select(t).selectAll(".filter").style("display","none").text(n.filter())),n}}};alsglance.dashboard.patients=alsglance.dashboard.patients||{waitingDialog:function(n){var t=n('<div class="modal" data-backdrop="false" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content"><div class="modal-header"><h6 style="margin:0;"><\/h6><\/div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0; height:16px;"><div class="progress-bar" style="width: 100%"><\/div><\/div><\/div><\/div><\/div><\/div>');return{show:function(i,r){var u=n.extend({dialogSize:"m",progressType:""},r);typeof i=="undefined"&&(i="Loading");typeof r=="undefined"&&(r={});t.find(".modal-dialog").attr("class","modal-dialog").addClass("modal-"+u.dialogSize);t.find(".progress-bar").attr("class","progress-bar");u.progressType&&t.find(".progress-bar").addClass("progress-bar-"+u.progressType);t.find("h6").html("Loading...<br/><br/><b>"+i+"<\/b>");t.modal()},hide:function(){t.modal("hide")}}}(jQuery),load:function(n,t,i){var r;aucBubbleChart=dc.bubbleChart("#aucBubbleChart");r=d3.format(".5f");n=n.value;n.forEach(function(n){var t=new Date;t.setISO8601(n.BornOn);n.age=moment().diff(t,"years")});var f=crossfilter(n),u=f.dimension(function(n){return n.Sex}),e=u.group().reduce(function(n,t){return++n.count,n.sumAge+=t.age,n.avgAge=n.sumAge/n.count,n},function(n,t){return--n.count,n.sumAge-=t.age,n.avgAge=n.count?n.sumAge/n.count:0,n},function(){return{sumAge:0,avgAge:0,count:0}});aucBubbleChart.transitionDuration(1500).margins({top:10,right:50,bottom:40,left:50}).dimension(u).group(e).colors(["rgb(49,130,189)","rgb(247,104,161)"]).colorAccessor(function(n){return n.key=="M"?0:1}).keyAccessor(function(n){return n.value.avgAge}).valueAccessor(function(n){return n.value.count}).radiusValueAccessor(function(n){return n.value.avgAge}).maxBubbleRelativeSize(.3).x(d3.scale.linear().domain([t,i])).y(d3.scale.linear().domain([-100,100])).r(d3.scale.linear().domain([0,4e3])).elasticY(!0).yAxisPadding(20).xAxisPadding(50).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).xAxisLabel("Average Age").yAxisLabel("# Patients").renderLabel(!0).label(function(n){return n.key}).renderTitle(!0).title(function(n){return[n.key,"# Patients: "+n.value.count,"Average Age: "+r(n.value.avgAge)].join("\n")}).yAxis().tickFormat(function(n){return n});dc.renderAll();$(".loading").remove()}};alsglance.dashboard.patient=alsglance.dashboard.patient||{saveSettings:function(){for(var t,i,n,u=[],r=0;r<dc.chartRegistry.list().length;r++)for(t=dc.chartRegistry.list()[r],i=0;i<t.filters().length;i++)u.push({ChartID:t.chartID(),Filter:t.filters()[i]});alsglance.dashboard.settings[alsglance.dashboard.patientId]=u;alsglance.dashboard.settings.colorScheme=selectedScheme;n={};n.UserId=alsglance.userId;n.ApplicationId=alsglance.applicationId;n.Value=encodeURIComponent(JSON.stringify(alsglance.dashboard.settings));$.ajax({type:"PUT",url:alsglance.baseUri+"ApplicationSettings(UserId='"+alsglance.dashboardUserId+"',ApplicationId='"+alsglance.applicationId+"')",data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",success:function(){toastr.success("Applied filters were successfully saved.","ALS Glance")},failure:function(n){toastr.error(n,"ALS Glance")}})},applyFilters:function(n){if(n!=null){for(var t=0;t<n.length;t++)dc.chartRegistry.list()[n[t].ChartID-1].filter(n[t].Filter);dc.redrawAll()}},reset:function(){dc.filterAll();alsglance.dashboard.patient.datePicker();$("#AT").addClass("active");$("#FCR").removeClass("active");$("#SCM").removeClass("active");alsglance.dashboard.patient.filterMuscle("AT");dc.redrawAll()},filterMuscle:function(n){muscleChart.filterAll();muscleChart.filter([n])},init:function(){$("#reset").click(function(){alsglance.dashboard.patient.reset()});$("#save").click(function(){alsglance.dashboard.patient.saveSettings()});$.each($("#muscles .btn"),function(n,t){var i=$(t).attr("id");$(t).click(i,function(){alsglance.dashboard.patient.filterMuscle(i);dc.redrawAll()})});alsglance.dashboard.init();alsglance.dashboard.patient.reset()},addPredictions:function(n){var i=[],r,u,f,s;n=n.value;n.forEach(function(n){i[n.MuscleAbbreviation]==null&&(i[n.MuscleAbbreviation]=[]);i[n.MuscleAbbreviation][n.TimeTimeOfDay]==null&&(i[n.MuscleAbbreviation][n.TimeTimeOfDay]=[]);i[n.MuscleAbbreviation][n.TimeTimeOfDay].push([new Date(n.DateDate).getTime(),n.AUC])});for(r in i)for(u in i[r]){var e=i[r][u],o=regression("linear",e).equation,t=moment(e[0][0]);for(f=1;f<36;f++)t=t.add(1,"months"),s=t.valueOf(),n.push({DateDate:t.format("YYYY-MM-DD HH:mm"),AUC:o[0]*s+o[1],DateMonthName:t.format("MMMM"),DateMonth:t.format("M"),DateYear:parseInt(t.format("YYYY")),DateQuarter:t.quarter(),PatientName:"Prediction",DateDayOfWeek:t.format("dddd"),TimeTimeOfDay:u,TimeHour:24,MuscleName:r,MuscleAbbreviation:r})}return n},loadEMG:function(n){emgChart=new Dygraph(document.getElementById("emgChart"),n,{legend:"always",colors:[colorbrewer[selectedScheme][numClasses][3]],labelsDivStyles:{textAlign:"right"}})},load:function(n,t,i){var e,u,o,f,r,s,y;muscleChart=dc.pieChart("#muscleChart");quarterChart=dc.pieChart("#quarterChart");timeHourChart=dc.barChart("#timeHourChart");timeOfDayChart=dc.rowChart("#timeOfDayChart");predictionSeriesChart=dc.seriesChart("#predictionSeriesChart");dateRangeChart=dc.barChart("#dateRangeChart");alsglance.dashboard.patient.datePicker=function(){var n=moment("01-01-"+t,"MM-DD-YYYY"),r=moment("12-31-"+i,"MM-DD-YYYY");$("#reportrange span").html(n.format("MMMM D, YYYY")+" - "+r.format("MMMM D, YYYY"));$("#reportrange").daterangepicker({format:"MM/DD/YYYY",startDate:n,endDate:moment(),minDate:n,maxDate:r,showDropdowns:!0,showWeekNumbers:!1,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Last Year":[moment().subtract(1,"year"),moment()]},opens:"left",drops:"down",buttonClasses:["btn","btn-sm"],applyClass:"btn-primary",cancelClass:"btn-default",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}},function(n,t){$("#reportrange span").html(n.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"));u.filter(null);u.filter(function(i){var r=i[1].valueOf();return r>n.valueOf()&&r<t.valueOf()});dc.redrawAll()})};o=d3.time.format("%Y/%m/%d");f=d3.format(".0f");n.forEach(function(n){var t=new Date;t.setISO8601(n.DateDate);n.DateDate=t;n.DateMonthInYear=d3.time.month(n.DateDate)});r=crossfilter(n);s=r.groupAll();e=r.dimension(function(n){return n.DateDate});var h=r.dimension(function(n){return n.DateMonthInYear}),p=h.group().reduceSum(function(n){return n.AUC}),c=r.dimension(function(n){return n.MuscleAbbreviation}),w=c.group().reduceCount();muscleChart.dimension(c).group(w);var l=r.dimension(function(n){return n.TimeHour}),b=l.group(),a=r.dimension(function(n){return"1."+n.TimeTimeOfDay}),k=a.group(),v=r.dimension(function(n){return"Q"+n.DateQuarter}),d=v.group().reduceCount();quarterChart.radius(90).innerRadius(50).dimension(v).group(d);timeOfDayChart.width(180).group(k).dimension(a).label(function(n){return n.key.split(".")[1]}).title(function(n){return n.value}).elasticX(!0).xAxis().ticks(4);timeHourChart.dimension(l).group(b).elasticY(!0).centerBar(!0).gap(1).round(dc.round.floor).alwaysUseRounding(!0).x(d3.scale.linear().domain([0,23])).renderHorizontalGridLines(!0).filterPrinter(function(n){var t=n[0];return""+(f(t[0])+"h -> "+f(t[1])+"h")});timeHourChart.xAxis().tickFormat(function(n){return n+"h"});timeHourChart.yAxis().ticks(6);u=r.dimension(function(n){return[n.PatientName,n.DateDate,n.DateYear]});y=u.group().reduceSum(function(n){return+n.AUC});predictionSeriesChart.margins({top:20,right:30,bottom:20,left:60}).width(460).height(180).x(d3.time.scale().domain([new Date(t,0,1),new Date(i+1,11,31)])).y(d3.scale.linear().domain([.009,.03])).brushOn(!1).dimension(u).group(y).rangeChart(dateRangeChart).seriesAccessor(function(n){return n.key[0]}).keyAccessor(function(n){return+n.key[1]}).valueAccessor(function(n){return+n.value}).legend(dc.legend().x(280).y(20).itemHeight(13).gap(5).legendWidth(170).itemWidth(170)).title(function(n){return o(n.key[1])+":\n"+n.value});dateRangeChart.width(460).height(60).mouseZoomable(!0).margins({top:10,right:50,bottom:20,left:60}).dimension(h).group(p).centerBar(!0).gap(1).x(d3.time.scale().domain([new Date(t,0,1),new Date(i+1,11,31)])).round(d3.time.month.round).alwaysUseRounding(!0).xUnits(d3.time.months).on("filtered",function(n){var i=n.filters(),t;i.length>0&&(t=i[0],$("#reportrange span").html(moment(t[0]).format("MMMM D, YYYY")+" - "+moment(t[1]).format("MMMM D, YYYY")))});dc.dataCount("#dc-data-count").dimension(r).group(s).html({some:"<strong>%filter-count<\/strong> selected out of <strong>%total-count<\/strong> records | <a href='javascript:alsglance.dashboard.patient.reset();''>Reset All<\/a>",all:"All records selected. Please click on the graph to apply filters."});dc.dataTable("#dc-data-table").dimension(e).group(function(n){return n.DateYear+"/"+n.DateMonthName}).size(100).columns([{label:"Date",format:function(n){return moment(n.DateDate).format("YYYY-MM-DD")}},{label:"Patient",format:function(n){return n.PatientName}},{label:"Time Of Day",format:function(n){return n.TimeTimeOfDay}},{label:"Time (h)",format:function(n){return n.TimeHour}},"AUC"]).sortBy(function(n){return n.DateDate}).order(d3.ascending).on("renderlet.post-process",function(){});dc.renderAll();$(".loading").remove()}};Date.prototype.setISO8601=function(n){var t=n.match(new RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),r=0,i=new Date(t[1],0,1),u;t[3]&&i.setMonth(t[3]-1);t[5]&&i.setDate(t[5]);t[7]&&i.setHours(t[7]);t[8]&&i.setMinutes(t[8]);t[10]&&i.setSeconds(t[10]);t[12]&&i.setMilliseconds(Number("0."+t[12])*1e3);t[14]&&(r=(Number(t[16])*60+Number(t[17]))*(t[15]=="-"?1:-1));r-=i.getTimezoneOffset();u=Number(i)+r*6e4;this.setTime(Number(u))};
//# sourceMappingURL=alsglance.dashboard.min.js.map
